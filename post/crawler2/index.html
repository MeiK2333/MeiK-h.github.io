<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://meik2333.com/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://meik2333.com/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://meik2333.com/css/github.min.css' />
    <link rel="stylesheet" href='https://meik2333.com/css/github-style.css' />
    <link rel="stylesheet" href='https://meik2333.com/css/light.css' />
    <link rel="stylesheet" href='https://meik2333.com/css/dark.css' />
    <link rel="stylesheet" href='https://meik2333.com/css/syntax.css' />
    <title>如何写一个爬虫 - 第二篇 - MeiK&#39;s blog</title>
    
    <link rel="icon" type="image/x-icon" href='https://meik2333.com/images/favicon.ico'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="从零开始实现一个爬虫。
" />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://meik2333.com/post/crawler2/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="如何写一个爬虫 - 第二篇 - MeiK&#39;s blog" />
<meta name="twitter:description"
  content="从零开始实现一个爬虫。
" />
<meta name="twitter:site" content="https://meik2333.com/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://meik2333.com/">


<meta property="og:type" content="article" />
<meta property="og:title" content="如何写一个爬虫 - 第二篇 - MeiK&#39;s blog">
<meta property="og:description"
  content="从零开始实现一个爬虫。
" />
<meta property="og:url" content="https://meik2333.com/post/crawler2/" />
<meta property="og:site_name" content="如何写一个爬虫 - 第二篇" />
<meta property="og:image"
  content="https://meik2333.com/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-08-05 20:56:35 &#43;0000 UTC" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://meik2333.com/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://meik2333.com/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://meik2333.com/">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://meik2333.com/">
                  <img class=" avatar-user"
                    src="https://meik2333.com/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://meik2333.com/">MeiK</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://meik2333.com/post/crawler2/">如何写一个爬虫 - 第二篇</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Mon, 05 Aug 2019 20:56:35 &#43;0000"
                    class="no-wrap">
                    Mon, 05 Aug 2019 20:56:35 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Fri, 11 Oct 2019 17:47:14 &#43;0800"
                    class="no-wrap">
                    Fri, 11 Oct 2019 17:47:14 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" class="btn btn-octicon m-0 mr-2 p-2" aria-haspopup="menu" aria-label="Table of Contents" role="button">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                          2764 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/%E7%88%AC%E8%99%AB">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      爬虫
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/python">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Python
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5">
                <article class="markdown-body entry-content container-lg"><p>从零开始实现一个爬虫。</p>

<blockquote>
<p>让我大吃一惊的是，我离开大学的时候就被告知，说我已经学过航海学了！——得了，我只要到港口去兜个圈，管保学到更多的航海知识。&mdash;&mdash;《瓦尔登湖》 - 亨利·大卫·梭罗</p>
</blockquote>

<p>上一篇中我们实现了一个 <code>fetch</code> 函数，这个函数接受一个 <code>url</code> 参数，并返回请求的响应体。在这一章里，我们将拓展这个函数的功能，并将其打包为可安装的库。</p>

<h2 id="改造-fetch-函数">改造 <code>fetch</code> 函数</h2>

<h3 id="定义函数签名">定义函数签名</h3>

<p>上一章中我们大概介绍了 HTTP 的格式，现在我们来对其中每一部分的格式与规范进行解读。</p>

<pre><code>[method] [path] [协议版本]
[header 字段]: [header 值]
...
[header 字段]: [header 值]

[数据]
</code></pre>

<p>在 HTTP 的请求格式中，除了协议版本外，我们有 method 、 path 、 header 字段和数据四部分可以自定义，我们就来将这四部分作为我们新的函数的参数。</p>

<p>我们首先来分别看一看这四部分每一部分的定义：</p>

<p><strong><code>method</code></strong></p>

<p>HTTP 定义的请求方法，目前有 <code>GET</code> 、 <code>HEAD</code> 、 <code>POST</code> 、 <code>PUT</code> 、 <code>DELETE</code> 、 <code>CONNECT</code> 、 <code>OPTIONS</code> 、<code>TRACE</code>  和 <code>PATCH</code> 九种，在 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods">MDN</a> 中可以查看其详细定义，其中最常用的是 <code>GET</code> 与 <code>POST</code> 。格式为字符串（Python 中的 <code>str</code> ）。</p>

<p><strong><code>path</code></strong></p>

<p>想要知道 <code>path</code> 是什么，就要先知道 URL 的格式定义（来自<a href="https://en.wikipedia.org/wiki/URL">维基百科</a>）：</p>

<pre><code>URI = scheme:[//authority]path[?query][#fragment]
authority = [userinfo@]host[:port]
</code></pre>

<p>（关于这里为什么是 URI 而非 URL ，可以参照<a href="https://stackoverflow.com/questions/176264/what-is-the-difference-between-a-uri-a-url-and-a-urn">这个问题</a>。简而言之， URL 是 URI 的子集。）</p>

<p>将其展开并去掉不常见的部分后，我们将其简化为下面这样：</p>

<pre><code>URL = scheme://host[:port]path[?query][#fragment]
</code></pre>

<ul>
<li>scheme: 连接服务器的协议，在网站的请求中，一般为 http 与 https 其中一个</li>
<li>host: 服务器的域，可能是域名或者 IP ，如果是域名的话，在连接时会首先将域名转化为 IP</li>
<li>port: 服务器提供服务的端口， HTTP 默认为 80 ， HTTPS 默认为 443</li>
<li>path: 在早期 HTTP 世界里，这个字段代表了要访问的资源的定位。现在它的具体含义由服务器端定义</li>
<li>query: HTTP GET 附带的查询参数，一般格式为 <code>key=value</code> 这样的键值对，但与 <code>path</code> 类似，它具体如何解释还是要看服务器的定义</li>
<li>fragment: 常用于页内资源定位</li>
</ul>

<p>一个常见的 URL 可能类似这样： <code>https://httpbin.org/get?key=value#1</code> ，需要注意的是， <code>#</code> 后的部分被称为 hash ，常见的作用是定位页面内的资源，一般来说不会被发送到服务器，仅在浏览器端生效。我们可以使用 <code>curl</code> 进行验证：</p>
<div class="highlight"><pre class="chroma"><code class="language-curl" data-lang="curl">$ curl &#39;https://httpbin.org/get?key=value#1&#39; -v
......
&gt; GET /get?key=value HTTP/1.1
&gt; Host: httpbin.org
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
......
{
  &#34;args&#34;: {
    &#34;key&#34;: &#34;value&#34;
  },
  &#34;headers&#34;: {
    &#34;Accept&#34;: &#34;*/*&#34;,
    &#34;Host&#34;: &#34;httpbin.org&#34;,
    &#34;User-Agent&#34;: &#34;curl/7.54.0&#34;
  },
  &#34;origin&#34;: &#34;36.110.78.251, 36.110.78.251&#34;,
  &#34;url&#34;: &#34;https://httpbin.org/get?key=value&#34;
}
* Connection #0 to host httpbin.org left intact</code></pre></div>
<p>可以看到， <code>#</code> 及其之后的部分并没有被发送到服务器，而 <code>key=value</code> 被解析为了键值对。</p>

<p>因此， <code>fragment</code> 部分不在我们的考虑范围内，我们要发送的 <code>path</code> 实际上是这里的 <code>path</code> 加上可选的查询字符串 <code>[?query]</code> ，在上面的例子里就是 <code>/get?key=value</code> 。其格式为字符串。</p>

<p><strong><code>header</code></strong></p>

<p>从上一章中可以看出， <code>header</code> 的格式为键值对——对应到 Python 里面，就是字典（ <code>dict</code> ）。</p>

<p>一个典型的 <code>header</code> 可能长这个样：</p>

<pre><code>User-Agent: ZeroCrawler
</code></pre>

<p><strong><code>data</code></strong></p>

<p>数据段（ <code>data</code> ）的格式为字符串，也是 HTTP 协议所规定的。根据 <code>header</code> 的不同，数据段有多种不同的解析方式，但我们先不考虑那么多，仅以字符串来表示它。</p>

<p>因此，为了能够最大程度的自定义我们的请求，我们的函数签名定义为下面这样：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
    <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span></code></pre></div>
<h3 id="填充函数内容">填充函数内容</h3>

<p>函数签名已经确定了，要填充其内容就比较简单了。我们要做的就是将每个参数填充到其应该在的位置。填充完的函数如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;http://&#34;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;url must start with `http://`&#34;</span><span class="p">)</span>

    <span class="n">_tmp</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_tmp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="n">_tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&#34;/&#34;</span>

    <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">params</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">headers</span>

    <span class="n">params_str</span> <span class="o">=</span> <span class="s2">&#34;?&#34;</span> <span class="k">if</span> <span class="n">params</span> <span class="k">else</span> <span class="s2">&#34;&#34;</span>
    <span class="n">param_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">param_count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">params_str</span> <span class="o">+=</span> <span class="s1">&#39;&amp;&#39;</span>
        <span class="n">params_str</span> <span class="o">+=</span> <span class="n">f</span><span class="s2">&#34;{key}={value}&#34;</span>
        <span class="n">param_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">request_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s2">&#34;{method} {path}{params_str} HTTP/1.0&#34;</span><span class="p">,</span> <span class="n">f</span><span class="s2">&#34;Host: {host}&#34;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">request_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;{key}: {value}&#34;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">request_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Content-Length: {len(data)}&#39;</span><span class="p">)</span>
        <span class="n">request_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># 空行，以分割header域与data域</span>
        <span class="n">request_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">request_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="p">)</span>

    <span class="n">request</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">request_list</span><span class="p">)</span>

    <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&#34;ascii&#34;</span><span class="p">))</span>

    <span class="n">response</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;&#34;</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">chunk</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">+=</span> <span class="n">chunk</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>

    <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span></code></pre></div>
<p>4 - 13 行中，我们从 URL 中分割出 <code>host</code> ，因为我们的函数还不支持 https ，因此我们对非 http 的请求抛出异常。</p>

<p>15 - 17 行，我们为可选的参数分配默认值，如果这些参数没有提供的话，则使用默认的策略填充。</p>

<p>19 - 25 行，我们将 <code>path</code> 中的 <code>query</code> 拼接起来，以便后面将其添加到 <code>path</code> 后面。</p>

<p>27 - 29 行，我们将 <code>header</code> 键值对加入请求中。</p>

<p>31 - 35 行，我们将可能存在的 <code>data</code> 添加到请求里。</p>

<p>往后的操作与我们上一章中所做的一样：开启 TCP 连接、发送请求、接收响应直到连接关闭。</p>

<p>试用一下我们的程序：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ZeroCrawler</span> <span class="kn">import</span> <span class="n">fetch</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">resp</span>
<span class="s1">&#39;HTTP/1.1 200 OK</span><span class="se">\r\n</span><span class="s1">Access-Control-Allow-Credentials: true</span><span class="se">\r\n</span><span class="s1">Access-Control-Allow-Origin: *</span><span class="se">\r\n</span><span class="s1">Content-Type: application/json</span><span class="se">\r\n</span><span class="s1">Date: Tue, 30 Jul 2019 12:19:26 GMT</span><span class="se">\r\n</span><span class="s1">Referrer-Policy: no-referrer-when-downgrade</span><span class="se">\r\n</span><span class="s1">Server: nginx</span><span class="se">\r\n</span><span class="s1">X-Content-Type-Options: nosniff</span><span class="se">\r\n</span><span class="s1">X-Frame-Options: DENY</span><span class="se">\r\n</span><span class="s1">X-XSS-Protection: 1; mode=block</span><span class="se">\r\n</span><span class="s1">Content-Length: 146</span><span class="se">\r\n</span><span class="s1">Connection: Close</span><span class="se">\r\n\r\n</span><span class="s1">{</span><span class="se">\n</span><span class="s1">  &#34;args&#34;: {}, </span><span class="se">\n</span><span class="s1">  &#34;headers&#34;: {</span><span class="se">\n</span><span class="s1">    &#34;Host&#34;: &#34;httpbin.org&#34;</span><span class="se">\n</span><span class="s1">  }, </span><span class="se">\n</span><span class="s1">  &#34;origin&#34;: &#34;36.110.78.251, 36.110.78.251&#34;, </span><span class="se">\n</span><span class="s1">  &#34;url&#34;: &#34;https://httpbin.org/get&#34;</span><span class="se">\n</span><span class="s1">}</span><span class="se">\n</span><span class="s1">&#39;</span></code></pre></div>
<h2 id="创建一个可安装的库">创建一个可安装的库</h2>

<p>至此，我们的函数已经能够有一定的可用性与灵活性了，现在我们要让其他人来使用我们的函数。</p>

<p>如果我们的程序的用户需要通过复制代码到自己项目内的方式来使用，那未免过于原始了。我们可以将程序打包为一个包，用户可以很方便的安装我们的程序。</p>

<p>官网有打包程序的文档： <a href="https://packaging.python.org/tutorials/packaging-projects/">Packaging Python Projects</a>，按照官网的指导，我们首先创建一个文件 <code>setup.py</code> ，写入如下内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">setuptools</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;README.md&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
    <span class="n">long_description</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">setuptools</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;ZeroCrawler&#34;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&#34;0.0.2&#34;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">&#34;MeiK2333&#34;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s2">&#34;meik2333@gmail.com&#34;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&#34;A small example package&#34;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">long_description</span><span class="p">,</span>
    <span class="n">long_description_content_type</span><span class="o">=</span><span class="s2">&#34;text/markdown&#34;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&#34;https://github.com/MeiK2333/ZeroCrawler&#34;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">setuptools</span><span class="o">.</span><span class="n">find_packages</span><span class="p">(),</span>
<span class="p">)</span></code></pre></div>
<p>这样就完成了，我们可以直接安装或使用 pip 安装：</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ python setup.py install  <span class="c1"># or pip install .</span>
Processing /Users/meik/ZeroCrawler
Installing collected packages: ZeroCrawler
  Running setup.py install <span class="k">for</span> ZeroCrawler ... <span class="k">done</span>
Successfully installed ZeroCrawler-0.0.2</code></pre></div>
<p>我们可以验证一下是否安装成功，我们切换到其他目录下，然后输出一下 <code>ZeroCrawler</code> 的位置：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ python -c <span class="s1">&#39;import ZeroCrawler; print(ZeroCrawler.__path__)&#39;</span>  <span class="c1"># 此时引入的 ZeroCrawler 是我们正在开发的版本</span>
<span class="o">[</span><span class="s1">&#39;/Users/meik/ZeroCrawler/ZeroCrawler&#39;</span><span class="o">]</span>
$ <span class="nb">cd</span> ~
$ python -c <span class="s1">&#39;import ZeroCrawler; print(ZeroCrawler.__path__)&#39;</span>  <span class="c1"># 此时引入的是我们安装的版本</span>
<span class="o">[</span><span class="s1">&#39;/Users/meik/ZeroCrawler/venv/lib/python3.6/site-packages/ZeroCrawler&#39;</span><span class="o">]</span></code></pre></div>
<p>可以看到， <code>ZeroCrawler</code> 库已经被安装到我们的系统里了，我们可以在其他项目中使用它。</p>

<p>如果想要更多的用户可以使用我们的项目（此时已经可以被称为库了），我们可以将项目提交到 GitHub 或者 <a href="https://pypi.org/">pypi</a> ， pip 可以直接安装 GitHub 或者 pypi 上公开的库。</p>

<h2 id="添加测试">添加测试</h2>

<p>添加了 <code>setup.py</code> 之后，我们的项目已经可以称之为一个库了，但距离成为一个有诚意的库还差一点，这一点就是测试。</p>

<p>测试的好处很多，提高代码质量、多人协作更加放心、可以作为使用指南等等，此处不做详解。我们只关心如何为我们的框架添加测试。</p>

<p>Python 的测试框架有很多，其中最常用的就是 unittest ，我以前写过一篇博客来介绍其基本用法：<a href="https://meik2333.com/2018/02/23/Python-%E4%B8%AD%E7%9A%84%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%EF%BC%88-unittest-%E7%9A%84%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95%EF%BC%89/">《Python 中的单元测试（ unittest 的基础用法）》</a>。</p>

<p>我们要测试的 <code>fetch</code> 函数返回值是响应的全部内容，不方便进行解析测试，因此我们创建了一个获取响应 <code>data</code> 的助手函数。</p>

<p>创建文件 <code>ZeroCrawler/utils.py</code> ，写入如下内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_body_by_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34; 从返回的响应中获得数据正文 &#34;&#34;&#34;</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span></code></pre></div>
<p>然后我们开始写测试，创建文件 <code>tests/test_fetch.py</code> ，写入如下内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">from</span> <span class="nn">ZeroCrawler</span> <span class="kn">import</span> <span class="n">fetch</span>
<span class="kn">from</span> <span class="nn">ZeroCrawler.utils</span> <span class="kn">import</span> <span class="n">get_body_by_response</span>


<span class="k">class</span> <span class="nc">TestFetch</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="s2">&#34;get&#34;</span><span class="p">,</span> <span class="s2">&#34;http://httpbin.org/get&#34;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;HTTP/1.1 200 OK&#34;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_fetch_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;key1&#34;</span><span class="p">:</span> <span class="s2">&#34;value1&#34;</span><span class="p">,</span> <span class="s2">&#34;key2&#34;</span><span class="p">:</span> <span class="s2">&#34;value2&#34;</span><span class="p">}</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="s2">&#34;get&#34;</span><span class="p">,</span> <span class="s2">&#34;http://httpbin.org/get&#34;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">get_body_by_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;args&#34;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_fetch_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;ZeroCrawler&#34;</span><span class="p">}</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="s2">&#34;get&#34;</span><span class="p">,</span> <span class="s2">&#34;http://httpbin.org/get&#34;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">get_body_by_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">resp_headers</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;headers&#34;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">resp_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">resp_headers</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_fetch_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;get&#34;</span><span class="p">,</span> <span class="s2">&#34;post&#34;</span><span class="p">,</span> <span class="s2">&#34;put&#34;</span><span class="p">,</span> <span class="s2">&#34;delete&#34;</span><span class="p">,</span> <span class="s2">&#34;patch&#34;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">f</span><span class="s2">&#34;http://httpbin.org/{method}&#34;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_body_by_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;url&#34;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;httpbin.org/{method}&#34;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_fetch_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&#34;Hello World!&#34;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="s2">&#34;post&#34;</span><span class="p">,</span> <span class="s2">&#34;http://httpbin.org/post&#34;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">resp_data</span> <span class="o">=</span> <span class="n">get_body_by_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="n">resp_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">resp_data</span><span class="p">[</span><span class="s2">&#34;data&#34;</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span></code></pre></div>
<p>这五组测试分别测试了我们函数的五个参数，写明了进行的操作和应该出现的结果。运行它：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ python -m unittest tests/test_*.py
......
----------------------------------------------------------------------
Ran <span class="m">5</span> tests in <span class="m">27</span>.590s

OK</code></pre></div>
<p>之后如果我们修改了项目，只要测试能通过，就代表我们现在已有的功能没有被破坏（当然，前提是有全面且合理的测试用例）。</p>

<p>至此，我们的项目结构如下所示：</p>

<pre><code>ZeroCrawler
    |
    |------ ZeroCrawler
    |         |-------- __init__.py
    |         |-------- fetch.py
    |         |-------- utils.py
    |      
    |------ tests
    |         |-------- test_fetch.p
    |
    |------ setup.py
</code></pre>

<h2 id="总结">总结</h2>

<p>这一章里，我们提高了我们框架的泛用性，并用我们的框架创建了一个可安装的库。我们的框架有了走向世界的基础。</p>

<p>本章的代码在 GitHub: <a href="https://github.com/MeiK2333/ZeroCrawler/tree/96f62b98bd93b3d384e846b4b5b53b1e593e3d5c">ZeroCrawler Version 0.0.2</a> 中，可以尝试 <code>fork</code> 它并自己进行修改。</p>

<p>我们的框架仅仅有个雏形，还有很多不足，比如意大利面条式的代码、没有对请求与响应内容的解析、用法并不友好等。这些问题我们会在后面的章节里一一改正，如果你认为我写的有什么不足之处，请在博客评论处或者 GitHub Issues 告诉我。我们下期再见。</p></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script>
 
 
 
 window.onload = function () {
   const header = document.getElementById('post-header');
   const headerHeight = header.offsetHeight;
   
   document.documentElement.style.scrollPaddingTop = headerHeight + 10 + "px";
 }

 const tocToggleButton = document.getElementById("toc-toggle");

 const tippyInstance = tippy('#toc-toggle', {
  trigger: 'click',
  content: '<div id="table-of-contents">\x3cnav id=\x22TableOfContents\x22\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22#改造-fetch-函数\x22\x3e改造 \x3ccode\x3efetch\x3c\/code\x3e 函数\x3c\/a\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22#定义函数签名\x22\x3e定义函数签名\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22#填充函数内容\x22\x3e填充函数内容\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22#创建一个可安装的库\x22\x3e创建一个可安装的库\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22#添加测试\x22\x3e添加测试\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22#总结\x22\x3e总结\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/nav\x3e</div>',
  allowHTML: true,
  placement: 'bottom-start',
  interactive: true,
  arrow: false,
  maxWidth: "none",
  onHide: function () { tocToggleButton.classList.remove("hover"); },
  onShow: function () { tocToggleButton.classList.add("hover"); },
  onShown: function () {
    selectTableOfContentsOption();

    if (window.hasSetupTableOfContentsListeners) {
      return;
    }

    const tableOfContents = document.getElementById("table-of-contents");
    tableOfContents.addEventListener('click', function () {
      
      tippyInstance[0].hide();
    });

    window.hasSetupTableOfContentsListeners = true;
  }
 });

 function selectTableOfContentsOption () {
   const optionSelectedClass = 'table-of-contents-option-selected';

   const tableOfContentsOptions = document.querySelectorAll("#table-of-contents > nav > ul li");

   for (const option of tableOfContentsOptions) {
     

     const [child] = option.children;
     if (child.tagName.toLowerCase() !== 'a') {
       continue;
     }

     if (window.location.href === child.href) {
       child.classList.add(optionSelectedClass);
     } else {
       child.classList.remove(optionSelectedClass);
     }
   }
 }

 window.onhashchange = selectTableOfContentsOption;
</script>


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://meik2333.com/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://meik2333.com/js/github-style.js"></script>



</html>